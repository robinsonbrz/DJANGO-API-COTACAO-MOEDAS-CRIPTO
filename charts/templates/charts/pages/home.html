{% extends 'charts/base.html' %}

{% block content %}


<div class="jumbotron jumbotron-fluid">
   <div class="container text-center">
      <h1 class="display-4">Cotação {{nome_moeda}}</h1>
      <p class="lead">Cotação {{par_moedas}} - {{nome_moeda}} últimos {{qtd_dias}} dias.</p>
   </div>
</div>



               <div class="container">
                  <form action="{% url 'cotacoes:home'  %}">
                  <div class="form-row">
                     <div class="form-group col-md-4">


                        <select name="par_moedas_form" id="par_moedas_form" class="form-control">
                           {% for par in pares %}
                              <option value={{par.0}}>{{par.1}}</option>
                           {% endfor %}
                        </select>
                     </div>
                     <div class="form-group col-md-4">

                        <select name="dias_form" id="dias_form" class="form-control">
                                 <option value="5">5</option>
                                 <option value="10">10</option>
                                 <option value="30">30</option>
                                 <option value="60" selected>60</option>
                                 <option value="90">90</option>
                                 <option value="120">120</option>
                                 <option value="180">180</option>
                        </select>
                     </div>
                     <div class=" col-md-4">
                        <button type="submit" class="btn btn-primary">Selecionar</button>
                     </div>
                  </div>
                  </form>
               </div>






   <!--  class oculta d-none
      também diminuir altura
   --> 
   <div class="m-4">
      <div class="row" >
         <div class="col-md-9">
            <div class="card">
               <div class="card-body mb-5">
                  <h5 class="card-title">{{nome_moeda}} - {{par_moedas}} /  {{qtd_dias}} dias</h5>
                  
                  <canvas id="myChart" ></canvas>
                  <br>
                  Exibição em Chart Js
               </div>
            </div>
            <div class="card mt-4">
               <div class="card-body">
                  <h5 class="card-title">{{nome_moeda}} - {{par_moedas}} /  {{qtd_dias}} dias</h5>
                  <div id="chart" >
                  </div>
                  Exibição em Apex Chart
               </div>
            </div>
         </div>

         <div class="col-md-3">
            <div class="card">
               <div class="card-body">
                  <h5 class="card-title">Cotação atual</h5>
                  <p class="card-text"><b>{{par_moedas}}<br>{{nome_moeda}}</b></p>
               </div>
               <ul class="list-group list-group-flush">
                  <li class="list-group-item"><b>Compra:</b> {{par_atual.bid}}<br><b>Venda:</b> {{par_atual.ask}}</li>
                  <li class="list-group-item"><b>Variação:</b> {{par_atual.pctChange}}%</li>
                  <li class="list-group-item"><b>High:</b> {{par_atual.high}}<br><b>Low:</b> {{par_atual.low}}</li>
                  <li class="list-group-item"> {{par_atual.create_date}}</li>
               </ul>
            </div>
         </div>

      </div>
   </div>  

      
   <script>
      // ChartJs 
      var lista_datas = {{ lista_datas | safe }};
      var lista_cotacoes = {{ lista_cotacoes | safe }};
      // var pares = {{ pares | safe }};

      // console.log(pares);

      const ctx = document.getElementById('myChart').getContext('2d');
      const myChart = new Chart(ctx, {
         type: 'line',
         data: {
            labels: lista_datas,
            datasets: [{
                  label: 'Lista Cotacoes',
                  data: lista_cotacoes,
                  backgroundColor: [
                     'rgba(54, 162, 235, 0.2)',
                  ],
                  borderColor: [
                     'rgba(54, 162, 235, 1)',
                  ],
                  pointStyle: 'circle',
                  borderWidth: 2,
                  pointRadius: 1,
                  pointHoverRadius: 15
               },
            ]
         },
         options: {
            scales: {
               y: {
                  beginAtZero: false
               }
            }
         }
      });
   </script>

   <script>
      // Apex Chart
      var options = {
         chart: {
            type: 'line'
         },
         stroke: {
            width: 2
         },
         series: [{
            name: 'Cotações',
            data: lista_cotacoes
         }],
         xaxis: {
            categories: lista_datas
         },

         grid: {
            row: {
                  colors: ['#e5e5e5', 'transparent'],
                  opacity: 0.5
            }, 
            column: {
                  colors: ['#f8f8f8', 'transparent'],
            }, 
            xaxis: {
               lines: {
                  show: true
               }
            },
            yaxis: {
               lines: {
                  show: true
               }
            },
            padding: {
               top: 0,
               right: 0,
               bottom: -30,
               left: 0
            }, 
         },
      }
      var chart = new ApexCharts(document.querySelector("#chart"), options);
      chart.render();
   </script>
   <script src="https://code.jquery.com/jquery-3.3.1.slim.min.js" integrity="sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo" crossorigin="anonymous"></script>
   <script src="https://cdn.jsdelivr.net/npm/popper.js@1.14.7/dist/umd/popper.min.js" integrity="sha384-UO2eT0CpHqdSJQ6hJty5KVphtPhzWj9WO1clHTMGa3JDZwrnQq4sF86dIHNDz0W1" crossorigin="anonymous"></script>
   <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.3.1/dist/js/bootstrap.min.js" integrity="sha384-JjSmVgyd0p3pXB1rRibZUAYoIIy6OrQ6VrjIEaFf/nJGzIxFDsf4x0xIM+B07jRM" crossorigin="anonymous"></script>

{% endblock %}
